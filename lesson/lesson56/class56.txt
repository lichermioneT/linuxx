三次握手是机制，并不是一定成功的。
四次挥手是机制，并不是一定成功的。

C                     S
        1.SYN值1--》         SYN_SEND
        2.《----- SYN+ACK    SYN_REVD
建立成功 3.ACK----》          建立成功
        握手完成。

握手不一定成功。
为什么要三次握手呢？
一次握手行不行呢？绝对不行的。Server一定要维护已经建立好的链接。SYN洪水。
两次握手行不行呢？同上的问题。SYN洪水。

三次握手：
a.使用最小成本验证全双工通信道是通畅的。 一进一出。
b.三次握手可以有效防止 单机进行对服务器进行攻击。
    服务器收到攻击，本身就不应该是tcp握手解决的！
    肉鸡
    
四次握手行不行呢？五次握手行不行呢？。。。。

三次握手其实可以理解成为四次握手。SYN和ACK可以分开。

为什么要三次握手呢？
预备
1.三次握手不一定非得成功，最担心的其实 是最后一个ACK丢失，但是有配套的解决方案。
2.链接需要被管理起来的，被OS管理起来的，先描述，后组织。维护一个链接需要成本的[时间和空间成本]


为什么一定是四次挥手呢？
建立链接一方主动
断开链接是双方的事情，需要征得双方的同意。

client                                                   server 
       1.我不想给你发消息了，我发完了，我要断开连接。--》FIN
       2.《----------------------ACK应答
       
       1.《----我不想给你发消息了，我发完了，我要断开连接。FIN
       2.ACK应答-----------------------------------》

    这里所谓的不发数据，指的是不发用户数据！
    TCP不知道，但是用户知道。
    ---上层会调用close(fd)
   
    并不代表底层没有管理报文的交换。

TCP为什么要连接》因为要保证可靠性。

主动断开链接的一方，最终状态是TIME_WAIT状态
被动断开链接的一方，两次挥手完成，会进入CLOSE_WAIT状态。
    和对方是C或者S无关系的。TCP是地位对等的协议。


如果我们的服务器出现大量的close_wait
1.服务器有bug，没有做close文件描述符的动作
2.服务器有压力，可可能一直在推送消息给client，导致来不及close.




























